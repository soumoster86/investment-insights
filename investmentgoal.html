<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Investment Insights - Investment Goal</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header style="display: flex; align-items: center; justify-content: space-between; padding: 15px 20px; background-color: #004080; color: white; flex-wrap: wrap;">
    <div style="display: flex; align-items: center;">
      <img src="logo.png" alt="Investment Insights Logo" style="height: 50px; margin-right: 15px;" />
      <h1 style="margin: 0; font-weight: normal; font-size: 1.5em;">Investment Insights</h1>
    </div>
    <label style="display: flex; align-items: center; gap: 8px; cursor:pointer; margin-top: 10px;">
      <input type="checkbox" id="darkmode-toggle" style="width:20px; height:20px;" />
      <span id="dm-label" style="color:white;font-size:1em;">ğŸŒ™ Dark Mode</span>
    </label>
    <nav style="width: 100%; margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px;">
      <a href="index.html" class="active">ğŸ  Home</a>
      <a href="stocks.html">ğŸ“Š Stocks</a>
      <a href="mutualfunds.html">ğŸ“ Mutual Funds</a>
      <a href="fixeddeposit.html">ğŸ¦ Fixed Deposits</a>
      <a href="cryptocurrencies.html">ğŸ’± Cryptocurrencies</a>
      <a href="bonds.html">ğŸ’¸ Bonds</a>
      <a href="investmentgoal.html">ğŸ¯ Investment Goal</a>
      <a href="contact.html">âœ‰ï¸ Contact</a>
    </nav>
  </header>
  <main>
    <section>
      <h2>Set Your Investment Goal</h2>
      <form id="goal-form" onsubmit="calculateGoal(event)">
        <label for="monthly-amount">Monthly Investment (â‚¹):</label>
        <input type="number" id="monthly-amount" min="0" required placeholder="Enter amount per month">

        <label for="routes">Investment Routes:</label>
        <select id="routes" multiple required style="height: 110px;">
          <option value="Stocks">Stocks</option>
          <option value="Mutual Funds">Mutual Funds</option>
          <option value="Fixed Deposits">Fixed Deposits</option>
          <option value="Cryptocurrencies">Cryptocurrencies</option>
        </select>
        <small style="color:#555;display:block;margin-bottom:12px;">(Hold Ctrl/Cmd to select multiple options)</small>

        <label for="rate">Expected Rate of Return (% per year):</label>
        <input type="number" id="rate" step="0.01" min="0" required placeholder="e.g. 11">

        <label for="inflation">Expected Inflation Rate (% per year):</label>
        <input type="number" id="inflation" step="0.01" min="0" required placeholder="e.g. 6">

        <label for="duration">Investment Duration (years):</label>
        <input type="number" id="duration" min="1" required placeholder="e.g. 15">

        <button type="submit" class="btn">Calculate Future Corpus</button>
      </form>
      <div id="goal-result" style="margin-top:18px;font-size:1.13em;color:#004080;font-weight:500;"></div>

      <!-- Chart Container -->
      <div style="margin:24px 0 0 0; background:#fff; border-radius:12px; padding:12px 6px;">
        <canvas id="plotSIPCorpusChart" style="max-width:100%;"></canvas>
      </div>
    </section>
  </main>
  <footer>
    &copy; 2025 Investment Insights. All rights reserved.
  </footer>

  <script>
    // XIRR Helper Function
    function xirr(cashFlows, dates, guess = 0.1) {
      const tol = 1e-7, maxIter = 100;
      const dayMs = 1000 * 60 * 60 * 24;
      const xnpv = (rate) => cashFlows.reduce((sum, c, i) =>
        sum + c / Math.pow(1 + rate, (dates[i] - dates[0]) / dayMs / 365), 0);

      let rate = guess;
      for (let iter = 0; iter < maxIter; iter++) {
        const npv = xnpv(rate);
        const dRate = rate * 1.0001 || 1e-6;
        const dNpv = (xnpv(dRate) - npv) / (dRate - rate);
        const newRate = rate - npv / dNpv;
        if (Math.abs(newRate - rate) < tol) return newRate;
        rate = newRate;
      }
      return rate;
    }

    // Chart Drawing Function
    function plotSIPCorpusChart({ P, rate, inflation, years, canvasId = "plotSIPCorpusChart" }) {
      const yearlyCorpus = [];
      const yearlyCorpusReal = [];
      const labels = [];
      const r = rate / 100 / 12;
      for (let year = 1; year <= years; year++) {
        const months = year * 12;
        const FV = r === 0
          ? P * months
          : P * (((Math.pow(1 + r, months) - 1) / r) * (1 + r));
        const inflationFactor = Math.pow(1 + inflation / 100, year);
        yearlyCorpus.push(FV);
        yearlyCorpusReal.push(FV / inflationFactor);
        labels.push('Year ' + year);
      }
      const ctx = document.getElementById(canvasId).getContext('2d');
      if (window.corpusChartInstance) window.corpusChartInstance.destroy();
      window.corpusChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            {
              label: 'Corpus (Nominal â‚¹)',
              data: yearlyCorpus,
              borderWidth: 2.5,
              borderColor: '#004080',
              backgroundColor: 'rgba(0,64,128,0.08)',
              tension: 0.15,
              pointRadius: 2,
              fill: false,
            },
            {
              label: 'Corpus (Inflation-Adjusted â‚¹)',
              data: yearlyCorpusReal,
              borderWidth: 2.2,
              borderColor: '#6c93db',
              backgroundColor: 'rgba(108,147,219,0.09)',
              tension: 0.18,
              pointRadius: 2,
              fill: false,
              borderDash: [6, 4],
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true, position: 'bottom' },
            tooltip: {
              callbacks: {
                label: function(ctx) {
                  return ctx.dataset.label + ': â‚¹' + Math.round(ctx.raw).toLocaleString();
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(val) {
                  return 'â‚¹' + (val / 100000 >= 1 ? (val / 100000).toFixed(1) + 'L' : val.toLocaleString());
                }
              }
            }
          }
        }
      });
    }

    // Main Calculation Function
    function calculateGoal(event) {
      event.preventDefault();
      const P = parseFloat(document.getElementById('monthly-amount').value);
      const rate = parseFloat(document.getElementById('rate').value);
      const inflation = parseFloat(document.getElementById('inflation').value);
      const n = parseInt(document.getElementById('duration').value);
      const routes = Array.from(document.getElementById('routes').selectedOptions).map(opt => opt.value);

      if (isNaN(P) || P <= 0 || isNaN(rate) || rate < 0 || isNaN(inflation) || inflation < 0 || isNaN(n) || n <= 0 || routes.length === 0) {
        alert('Please fill all fields correctly.');
        return;
      }

      const r = rate / 100 / 12;
      const months = n * 12;
      let FV;
      if (r === 0) {
        FV = P * months;
      } else {
        FV = P * (((Math.pow(1 + r, months) - 1) / r) * (1 + r));
      }

      // XIRR Calculation
      const cashFlows = [];
      const dates = [];
      const startDate = new Date();
      for (let i = 0; i < months; i++) {
        const d = new Date(startDate.getFullYear(), startDate.getMonth() + i, startDate.getDate());
        cashFlows.push(-P);
        dates.push(d);
      }
      const endDate = new Date(startDate.getFullYear(), startDate.getMonth() + months, startDate.getDate());
      cashFlows.push(FV);
      dates.push(endDate);

      const irr = xirr(cashFlows, dates) * 100;
      const realIRR = irr - inflation;

      let inflationMsg;
      if (realIRR > 0) {
        inflationMsg = `ğŸ‰ Your investment is projected to beat inflation by <b>${realIRR.toFixed(2)}%</b> per year (XIRR).`;
      } else if (realIRR === 0) {
        inflationMsg = `âš–ï¸ Your investment is projected to match inflation.`;
      } else {
        inflationMsg = `âš ï¸ Your investment may <b>not</b> keep up with inflation and could lose value in real terms.`;
      }

      document.getElementById('goal-result').innerHTML = `
        <strong>Future Corpus (Nominal):</strong> â‚¹${FV.toLocaleString(undefined, {maximumFractionDigits:0})}<br>
        <strong>Total Invested:</strong> â‚¹${(P*months).toLocaleString(undefined, {maximumFractionDigits:0})}<br>
        <strong>XIRR (Annualized Return):</strong> ${irr.toFixed(2)}%<br>
        <strong>Inflation-adjusted (Real) XIRR:</strong> ${realIRR.toFixed(2)}%<br>
        <strong>Selected Routes:</strong> ${routes.join(', ')}<br>
        <div style="margin-top:14px;font-size:1.11em;">${inflationMsg}</div>
      `;

      // Draw chart
      plotSIPCorpusChart({
        P: P,
        rate: rate,
        inflation: inflation,
        years: n,
        canvasId: "plotSIPCorpusChart"
      });
    }
  </script>

  <script>
    // Dark Mode Script (unchanged)
    function setMode(dark) {
      if (dark) {
        document.body.classList.add("dark-mode");
        localStorage.setItem("theme", "dark");
        document.getElementById('dm-label').textContent = "â˜€ï¸ Light Mode";
        document.getElementById('darkmode-toggle').checked = true;
      } else {
        document.body.classList.remove("dark-mode");
        localStorage.setItem("theme", "light");
        document.getElementById('dm-label').textContent = "ğŸŒ™ Dark Mode";
        document.getElementById('darkmode-toggle').checked = false;
      }
    }
    document.getElementById('darkmode-toggle').addEventListener("change", function() {
      setMode(this.checked);
    });
    (function() {
      const userPref = localStorage.getItem("theme");
      const darkPref = userPref === "dark" ||
        (!userPref && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
      setMode(darkPref);
    })();
  </script>
</body>
</html>

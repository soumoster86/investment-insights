<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Investment Insights - Investment Goal</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      background: linear-gradient(120deg, #e9f0fd 0%, #f4f6f8 100%);
      color: #222;
      min-height: 100vh;
      transition: background 0.4s, color 0.3s;
    }
    header {
      background: #004080;
      color: white;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    header img {
      height: 50px;
      margin-right: 15px;
      border-radius: 10px;
      background: #fff;
      padding: 3px;
      box-shadow: 0 2px 6px #0001;
    }
    header h1 {
      margin: 0;
      font-weight: normal;
      font-size: 1.5em;
    }
    #dm-label {
      color: white;
      font-size: 1em;
    }
    nav {
      width: 100%;
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      background: none;
      color: inherit;
    }
    nav a {
      color: white;
      text-decoration: none;
      margin: 0 14px;
      font-weight: 500;
      font-size: 1.08em;
      padding: 7px 10px;
      border-radius: 7px;
      transition: background .22s;
    }
    nav a.active,
    nav a:hover {
      background: #012b54;
      text-decoration: underline;
    }
    main {
      max-width: 900px;
      margin: 36px auto 24px auto;
      padding: 0 15px 30px 15px;
      background: #fff;
      box-shadow: 0 2px 12px rgb(0 64 128 / 8%);
      border-radius: 18px;
      min-height: 75vh;
      animation: fadeIn 0.8s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px);}
      to   { opacity: 1; transform: translateY(0);}
    }
    section {
      margin-bottom: 34px;
      padding: 20px 22px;
      border: 1.5px solid #e1e6f2;
      border-radius: 12px;
      background: #f9faff;
      box-shadow: 0 1px 10px #00408009;
      transition: box-shadow 0.18s, border-color 0.2s;
    }
    section:hover {
      box-shadow: 0 2px 22px #00408017;
      border-color: #00408055;
    }
    h2 {
      border-bottom: 2px solid #004080;
      padding-bottom: 8px;
      color: #004080;
      margin-top: 0;
      font-size: 1.5em;
    }
    h3 {
      color: #004080;
      font-size: 1.17em;
      margin-bottom: 12px;
      margin-top: 20px;
    }
    .download-btn {
      background: #004080;
      color: white !important;
      border: none;
      padding: 9px 16px;
      border-radius: 7px;
      cursor: pointer;
      font-size: 1.01em;
      font-weight: 500;
      box-shadow: 0 1px 4px #00408012;
      text-decoration: none;
      margin: 14px 0 0 0;
      display: inline-block;
      transition: background .22s, color .19s, border .18s, transform 0.17s;
    }
    .download-btn:hover, .download-btn:focus {
      background: #002d59;
      color: #e0eefa !important;
      transform: translateY(-2px) scale(1.04);
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 8px;
      background: #fafdff;
      border-radius: 9px;
      overflow: hidden;
    }
    th, td {
      padding: 8px 12px;
      border: 1px solid #e4eaf2;
      text-align: center;
    }
    th {
      background: #e9f0fd;
      color: #222;
    }
    .info-box, .tips-box, .faq-box, .assumptions-box {
      margin-top: 28px;
      padding: 18px 22px 13px 22px;
      border-radius: 11px;
      border: 1.5px solid #e4eaf2;
    }
    .info-box {
      background: #f4faff;
    }
    .assumptions-box {
      background: #fffce7;
      border: 1.5px solid #ffe28a;
    }
    .tips-box {
      background: #eefaf2;
      border: 1.5px solid #b5f0b1;
    }
    .faq-box {
      background: #f9faff;
      border: 1.5px solid #b8cee6;
    }
	
	
	body.dark-mode {
  background: linear-gradient(120deg,#141b27 0%, #22242a 100%) !important;
  color: #e7ecfa !important;
}
body.dark-mode header, body.dark-mode nav, body.dark-mode footer {
  background: #12203a !important;
  color: #e7ecfa !important;
}
body.dark-mode main,
body.dark-mode section,
body.dark-mode .info-box,
body.dark-mode .tips-box,
body.dark-mode .faq-box,
body.dark-mode .assumptions-box {
  background: #191c23 !important;
  color: #e7ecfa !important;
  box-shadow: 0 2px 12px #0004;
  border-color: #2d3752 !important;
}
body.dark-mode h2, 
body.dark-mode h3, 
body.dark-mode .faq-box h3, 
body.dark-mode .tips-box h3, 
body.dark-mode .assumptions-box h3 {
  color: #8abaff !important;
  border-color: #273a5a !important;
}
body.dark-mode .download-btn {
  background: #194276 !important;
  color: #fff !important;
  border-color: #446db6 !important;
}
body.dark-mode .download-btn:hover, 
body.dark-mode .download-btn:focus {
  background: #2966c2 !important;
  color: #d8e9fa !important;
}
body.dark-mode th, 
body.dark-mode td {
  background: #23273b !important;
  color: #e7ecfa !important;
  border-color: #2d3752 !important;
}
body.dark-mode th {
  background: #273a5a !important;
  color: #b0cdfb !important;
}
body.dark-mode table {
  background: #1b2231 !important;
}
body.dark-mode input, 
body.dark-mode select {
  background: #222a3d !important;
  color: #e7ecfa !important;
  border: 1.3px solid #273a5a !important;
}
body.dark-mode label, body.dark-mode small {
  color: #b0cdfb !important;
}
body.dark-mode #dm-label { color: #fff !important; }

	
	
	
  </style>
</head>
<body>
  <header style="display: flex; align-items: center; justify-content: space-between; padding: 15px 20px; background-color: #004080; color: white; flex-wrap: wrap;">
    <div style="display: flex; align-items: center;">
      <img src="logo.png" alt="Investment Insights Logo" style="height: 50px; margin-right: 15px;" />
      <h1>üí°Investment Insights: Learn. Grow. Prosper.</h1>
    </div>
    <label style="display: flex; align-items: center; gap: 8px; cursor:pointer; margin-top: 10px;">
      <input type="checkbox" id="darkmode-toggle" style="width:20px; height:20px;" />
      <span id="dm-label" style="color:white;font-size:1em;">üåô Dark Mode</span>
    </label>
    <nav style="width: 100%; margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px;">
      <a href="index.html" class="active">üè† Home</a>
      <a href="stocks.html">üìä Stocks</a>
      <a href="mutualfunds.html">üìÅ Mutual Funds</a>
      <a href="fixeddeposit.html">üè¶ Fixed Deposits</a>
      <a href="cryptocurrencies.html">üí± Cryptocurrencies</a>
      <a href="bonds.html">üí∏ Bonds</a>
      <a href="investmentgoal.html">üéØ Investment Goal</a>
      <a href="contact.html">‚úâÔ∏è Contact</a>
    </nav>
  </header>
  <main>
    <section>
      <h2>Set Your Investment Goal</h2>
      <form id="goal-form" onsubmit="calculateGoal(event)">
        <label for="routes">Select Investment Routes:</label>
		<select id="routes" multiple required style="height: 110px;" onchange="generateAmountFields(); updateTotalAmount();">
  <option value="Stocks">Stocks</option>
  <option value="Mutual Funds">Mutual Funds</option>
  <option value="Bonds">Bonds</option>
  <option value="Fixed Deposits">Fixed Deposits</option>
  <option value="Cryptocurrencies">Cryptocurrencies</option>
</select>

<small style="color:#555;display:block;margin-top:5px;margin-bottom:12px;">(Hold Ctrl/Cmd to select multiple options)</small>

<button type="button" class="btn secondary" id="suggest-portfolio-btn" onclick="showPortfolioModal()" style="margin-bottom:7px;">
  üí° Suggest Portfolio
</button>
<div id="suggest-portfolio-msg" style="font-size:0.97em; color:#ca7500; margin-bottom:10px; display:none;">
  * This button is disabled after manual selection. Click on the Reset button below to enable again.
</div>


<!-- Modal for Portfolio Suggestion -->
<div id="portfolio-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.33); z-index:5000; justify-content:center; align-items:center;">
  <div style="background:#fff; padding:28px 20px 18px 20px; border-radius:13px; min-width:340px; max-width:92vw; box-shadow:0 4px 22px #0013;">
    <h3 style="margin-top:0; color:#004080;">Portfolio Model Suggestion</h3>
    <label for="risk-profile"><b>Select Risk Profile:</b></label>
    <select id="risk-profile" style="margin-bottom:14px; width:100%;">
      <option value="moderate">Moderate (Balanced)</option>
      <option value="aggressive">Aggressive (Growth)</option>
      <option value="conservative">Conservative (Safe)</option>
    </select>
    <div id="suggestion-table" style="margin-bottom:12px;">
      <!-- Model allocations appear here -->
    </div>
    <label><b>Total Monthly Investment (‚Çπ):</b></label>
    <input type="number" id="modal-total-amt" min="100" value="20000" style="width:90%; margin-bottom:10px;" />
    <div style="text-align:right;">
      <button type="button" class="btn" onclick="applySuggestedPortfolio()">Apply</button>
      <button type="button" class="btn secondary" onclick="closePortfolioModal()">Cancel</button>
    </div>
  </div>
</div>

		
<!-- Dynamic input fields for amounts -->
<div id="route-amount-fields" style="margin-bottom: 10px;"></div>

        <div id="monthly-investment-total" style="margin:8px 0 18px 0; font-weight: 500; font-size:1.14em; color: #0a3965; display:none;">
        Total Monthly Investment: ‚Çπ<span id="total-amount-value">0</span>
        </div>
		
		<label for="rate" style="display:flex;align-items:center;gap:7px;">
  Expected Rate of Return (% per year):
  <span id="return-info" tabindex="0" style="cursor:pointer; color:#004080; font-size:1.1em; display:inline-block; position:relative;">
    <svg width="18" height="18" style="vertical-align:-2px;"><circle cx="9" cy="9" r="8" fill="#eaf2ff" stroke="#004080" stroke-width="1.5"/><text x="9" y="13" text-anchor="middle" font-size="12" fill="#004080" font-family="Segoe UI,Arial" font-weight="bold">i</text></svg>
    <span id="rate-tooltip" style="display:none;position:absolute;left:24px;top:-8px;z-index:1000;background:#fff;border:1.5px solid #e1e6f2;box-shadow:0 3px 12px #00408022;padding:13px 17px 11px 13px;border-radius:8px;font-size:0.97em;color:#1a2c4b;min-width:200px;max-width:350px;white-space:normal;">
      <!-- Dynamic content goes here -->
    </span>
  </span>
</label>
        <input type="number" id="rate" step="0.01" min="0" required placeholder="e.g. 11">

        <label for="inflation" style="display:flex;align-items:center;gap:7px;">
  Expected Inflation Rate (% per year):
  <span id="inflation-info" tabindex="0" style="cursor:pointer; color:#004080; font-size:1.1em; display:inline-block; position:relative;">
    <svg width="18" height="18" style="vertical-align:-2px;"><circle cx="9" cy="9" r="8" fill="#eaf2ff" stroke="#004080" stroke-width="1.5"/><text x="9" y="13" text-anchor="middle" font-size="12" fill="#004080" font-family="Segoe UI,Arial" font-weight="bold">i</text></svg>
    <span id="inflation-tooltip" style="
  display:none;
  position:absolute;
  left:0;
  top:130%;
  z-index:1000;
  background:#fff;
  border:1.5px solid #e1e6f2;
  box-shadow:0 3px 12px #00408022;
  padding:13px 17px 11px 13px;
  border-radius:8px;
  font-size:0.97em;
  color:#1a2c4b;
  min-width:220px;
  max-width:380px;
  max-height:300px;
  overflow:auto;
  white-space:normal;
">
      <!-- Historic inflation data will be loaded here -->
    </span>
  </span>
</label>
<input type="number" id="inflation" step="0.01" min="0" required placeholder="e.g. 6">

        <label for="duration">Investment Duration (years):</label>
        <input type="number" id="duration" min="1" required placeholder="e.g. 15">

        <div style="display: flex; gap: 14px;">
        <button type="submit" onclick="calculateGoal(event)">Calculate Future Corpus</button>
        <button type="button" class="btn secondary" onclick="resetGoalForm()">Reset</button>
        </div>
      </form>
      <div id="goal-result" style="margin-top:18px;font-size:1.13em;color:#004080;font-weight:500;"></div>
      <!-- Chart Container -->
      <div id="chart-section" style="margin:24px 0 0 0; background:#fff; border-radius:12px; padding:12px 6px; display:none;">
      <canvas id="plotSIPCorpusChart" style="max-width:100%;"></canvas>
      </div>
      <!-- Projection Table and Download -->
      <div id="projection-table-container" style="margin-top:30px;"></div>
      <button id="download-csv-btn" class="download-btn" style="display:none;" onclick="downloadProjectionCSV()">‚¨áÔ∏è Download Projection Table as CSV</button>
    </section>
	
	    <section class="assumptions-box" id="assumptions-section" style="display:none;">
  <h3>‚ö†Ô∏è Assumptions & Limitations</h3>
  <ul>
    <li>Assumes fixed monthly investment throughout the period.</li>
    <li>Does not include taxes, transaction costs, or step-up SIPs.</li>
    <li>Projected rates are not guaranteed‚Äîreturns depend on market performance.</li>
    <li>Inflation and return rates are user-entered and may differ from actuals.</li>
  </ul>
</section>
	
    <!-- FAQ, Assumptions, Tips sections -->
    <section class="faq-box">
      <h3>üìö Investment Goal FAQs & Guidance</h3>
      <ul>
        <li><b>What is XIRR?</b> XIRR (Extended Internal Rate of Return) gives your true annualized return, accounting for all cash flows and timing, making it the gold standard for comparing different investments.</li>
        <li><b>Why consider inflation?</b> Inflation reduces your money‚Äôs buying power over time. Always look at the <b>inflation-adjusted corpus</b> to see your real wealth growth.</li>
        <li><b>What does ‚ÄúFuture Corpus‚Äù mean?</b> This is the total wealth you‚Äôll accumulate, assuming all your planned investments and expected returns hold true.</li>
        <li><b>What‚Äôs the benefit of investing monthly?</b> Monthly SIPs smooth out market ups and downs, help you save consistently, and build wealth through compounding.</li>
      </ul>
    </section>
	
    <section class="tips-box">
      <h3>üí° Tips for Smart Investing</h3>
      <ul>
        <li>Start early‚Äîeven small investments grow big over time.</li>
        <li>Review your investments every year and rebalance if needed.</li>
        <li>Increase your SIP amount as your income grows.</li>
        <li>Consult a financial advisor for personalized advice.</li>
      </ul>
    </section>
  </main>
  <footer>
    &copy; 2025 Investment Insights. All rights reserved.
  </footer>

  <script>
  
  const historicReturns = {
  "Stocks": "11-13% p.a.",
  "Mutual Funds": "10-13% p.a.",
  "Bonds": "6.5-7.5% p.a.",
  "Fixed Deposits": "6-7% p.a.",
  "Cryptocurrencies": "Highly volatile, varies widely"
};

  const indiaInflationHistory = [
  { year: 2024, rate: 5.4 },
  { year: 2023, rate: 5.7 },
  { year: 2022, rate: 6.7 },
  { year: 2021, rate: 5.1 },
  { year: 2020, rate: 6.6 },
  { year: 2019, rate: 3.7 },
  { year: 2018, rate: 3.4 },
  { year: 2017, rate: 3.3 },
  { year: 2016, rate: 4.9 },
  { year: 2015, rate: 4.9 },
  { year: 2014, rate: 6.7 },
  { year: 2013, rate: 9.4 },
  { year: 2012, rate: 10.0 },
  { year: 2011, rate: 8.9 },
  { year: 2010, rate: 11.9 }
  // Source: RBI, World Bank, Trading Economics
];
  
  
    // Reset Button functionality
    function resetGoalForm() {
  document.getElementById('goal-form').reset();
  document.getElementById('route-amount-fields').innerHTML = '';
  document.getElementById('total-amount-value').textContent = '0';
  document.getElementById('monthly-investment-total').style.display = 'none';
  document.getElementById('goal-result').innerHTML = '';
  document.getElementById('projection-table-container').innerHTML = '';
  document.getElementById('download-csv-btn').style.display = 'none';
  document.getElementById('assumptions-section').style.display = "none";
  document.getElementById('chart-section').style.display = "none";
  if (window.corpusChartInstance) window.corpusChartInstance.destroy();
  enableSuggestPortfolio(); // <--- This MUST be called
}

  
    // Generate Total Amount Dynamically
    function generateAmountFields() {
      const selected = Array.from(document.getElementById('routes').selectedOptions).map(opt => opt.value);
      const container = document.getElementById('route-amount-fields');
      container.innerHTML = ''; // clear previous

      selected.forEach(route => {
        const inputId = `amount-${route.replace(/\s+/g, '').toLowerCase()}`;
        container.innerHTML += `
          <label for="${inputId}">Monthly Investment in ${route} (‚Çπ):</label>
          <input type="number" min="0" id="${inputId}" class="route-amount" placeholder="Amount for ${route}" oninput="updateTotalAmount()" required>
        `;
      });

      updateTotalAmount(); // reset total when selection changes
    }
	
    // Calculate and update total monthly investment
    function updateTotalAmount() {
  const inputs = document.querySelectorAll('.route-amount');
  let total = 0;
  inputs.forEach(input => {
    const val = parseFloat(input.value);
    if (!isNaN(val) && val > 0) total += val;
  });
  document.getElementById('total-amount-value').textContent = total.toLocaleString('en-IN');
  // Show the total only if there are route inputs (fields are present)
  document.getElementById('monthly-investment-total').style.display = inputs.length > 0 ? 'block' : 'none';
}

    // XIRR Helper Function
    function xirr(cashFlows, dates, guess = 0.1) {
      const tol = 1e-7, maxIter = 100;
      const dayMs = 1000 * 60 * 60 * 24;
      const xnpv = (rate) => cashFlows.reduce((sum, c, i) =>
        sum + c / Math.pow(1 + rate, (dates[i] - dates[0]) / dayMs / 365), 0);

      let rate = guess;
      for (let iter = 0; iter < maxIter; iter++) {
        const npv = xnpv(rate);
        const dRate = rate * 1.0001 || 1e-6;
        const dNpv = (xnpv(dRate) - npv) / (dRate - rate);
        const newRate = rate - npv / dNpv;
        if (Math.abs(newRate - rate) < tol) return newRate;
        rate = newRate;
      }
      return rate;
    }

    // Chart Drawing Function
    function plotSIPCorpusChart({ P, rate, inflation, years, canvasId = "plotSIPCorpusChart" }) {
      const yearlyCorpus = [];
      const yearlyCorpusReal = [];
      const labels = [];
      const r = rate / 100 / 12;
      for (let year = 1; year <= years; year++) {
        const months = year * 12;
        const FV = r === 0
          ? P * months
          : P * (((Math.pow(1 + r, months) - 1) / r) * (1 + r));
        const inflationFactor = Math.pow(1 + inflation / 100, year);
        yearlyCorpus.push(FV);
        yearlyCorpusReal.push(FV / inflationFactor);
        labels.push('Year ' + year);
      }
      const ctx = document.getElementById(canvasId).getContext('2d');
      if (window.corpusChartInstance) window.corpusChartInstance.destroy();
      window.corpusChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            {
              label: 'Corpus (Nominal ‚Çπ)',
              data: yearlyCorpus,
              borderWidth: 2.5,
              borderColor: '#004080',
              backgroundColor: 'rgba(0,64,128,0.08)',
              tension: 0.15,
              pointRadius: 2,
              fill: false,
            },
            {
              label: 'Corpus (Inflation-Adjusted ‚Çπ)',
              data: yearlyCorpusReal,
              borderWidth: 2.2,
              borderColor: '#6c93db',
              backgroundColor: 'rgba(108,147,219,0.09)',
              tension: 0.18,
              pointRadius: 2,
              fill: false,
              borderDash: [6, 4],
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true, position: 'bottom' },
            tooltip: {
              callbacks: {
                title: function(ctx) {
                  return ctx[0].label;
                },
                label: function(ctx) {
                  const value = ctx.parsed.y;
                  const label = ctx.dataset.label;
                  return label + ': ‚Çπ' + Math.round(value).toLocaleString('en-IN');
                },
                afterBody: function(ctx) {
                  if (ctx.length === 1 && ctx[0].datasetIndex === 0 && ctx[0].chart.data.datasets.length > 1) {
                    const yearIndex = ctx[0].dataIndex;
                    const realValue = ctx[0].chart.data.datasets[1].data[yearIndex];
                    return 'Corpus (Inflation-Adjusted ‚Çπ): ‚Çπ' + Math.round(realValue).toLocaleString('en-IN');
                  } else if (ctx.length === 1 && ctx[0].datasetIndex === 1 && ctx[0].chart.data.datasets.length > 0) {
                    const yearIndex = ctx[0].dataIndex;
                    const nominalValue = ctx[0].chart.data.datasets[0].data[yearIndex];
                    return 'Corpus (Nominal ‚Çπ): ‚Çπ' + Math.round(nominalValue).toLocaleString('en-IN');
                  }
                  return '';
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(val) {
                  // Show in Lakhs if value >= 1L, else in Indian grouping
                  return '‚Çπ' + (val / 100000 >= 1
                    ? (val / 100000).toFixed(1) + 'L'
                    : val.toLocaleString('en-IN'));
                }
              }
            }
          }
        }
      });
    }

    // Generate and display yearly projection table
    function showProjectionTable(P, rate, inflation, years) {
      let html = `<h3 style="color:#004080;">Yearly Corpus Projection</h3>
      <table>
        <tr>
          <th>Year</th>
          <th>Nominal Corpus (‚Çπ)</th>
          <th>Inflation-Adjusted (‚Çπ)</th>
        </tr>`;
      const r = rate/100/12;
      let tableData = [];
      for (let year=1; year<=years; year++) {
        const months = year*12;
        const FV = r===0 ? P*months : P*(((Math.pow(1+r,months)-1)/r)*(1+r));
        const FVReal = FV / Math.pow(1+inflation/100, year);
        html += `<tr>
          <td>${year}</td>
          <td>‚Çπ${Math.round(FV).toLocaleString('en-IN')}</td>
          <td>‚Çπ${Math.round(FVReal).toLocaleString('en-IN')}</td>
        </tr>`;
        tableData.push({year, FV, FVReal});
      }
      html += `</table>`;
      document.getElementById('projection-table-container').innerHTML = html;
      document.getElementById('download-csv-btn').style.display = 'inline-block';
      window.projectionTableData = tableData; // for download
    }

    // Download CSV logic
    function downloadProjectionCSV() {
      if (!window.projectionTableData) return;
      let csv = "Year,Nominal Corpus (INR),Inflation-Adjusted (INR)\n";
      window.projectionTableData.forEach(row => {
        csv += `${row.year},${Math.round(row.FV)},${Math.round(row.FVReal)}\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = "investment_projection.csv";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    // Main Calculation Function
    function calculateGoal(event) {
      event.preventDefault();
	  let P = 0;
      document.querySelectorAll('.route-amount').forEach(input => {
        const val = parseFloat(input.value);
        if (!isNaN(val) && val > 0) P += val;
      });
      const rate = parseFloat(document.getElementById('rate').value);
      const inflation = parseFloat(document.getElementById('inflation').value);
      const n = parseInt(document.getElementById('duration').value);
      const routes = Array.from(document.getElementById('routes').selectedOptions).map(opt => opt.value);

      if (P <= 0) {
        alert('Please enter at least one investment amount.');
        return;
      }

      if (isNaN(P) || P <= 0 || isNaN(rate) || rate < 0 || isNaN(inflation) || inflation < 0 || isNaN(n) || n <= 0 || routes.length === 0) {
        alert('Please fill all fields correctly.');
        return;
      }

      const r = rate / 100 / 12;
      const months = n * 12;
      let FV;
      if (r === 0) {
        FV = P * months;
      } else {
        FV = P * (((Math.pow(1 + r, months) - 1) / r) * (1 + r));
      }
      // Inflation-adjusted corpus
      const inflationFactor = Math.pow(1 + inflation / 100, n);
      const FVReal = FV / inflationFactor;

      // XIRR Calculation
      const cashFlows = [];
      const dates = [];
      const startDate = new Date();
      for (let i = 0; i < months; i++) {
        const d = new Date(startDate.getFullYear(), startDate.getMonth() + i, startDate.getDate());
        cashFlows.push(-P);
        dates.push(d);
      }
      const endDate = new Date(startDate.getFullYear(), startDate.getMonth() + months, startDate.getDate());
      cashFlows.push(FV);
      dates.push(endDate);

      const irr = xirr(cashFlows, dates) * 100;
      const realIRR = irr - inflation;

      let inflationMsg;
      if (realIRR > 0) {
        inflationMsg = `üéâ Your investment is projected to beat inflation by <b>${realIRR.toFixed(2)}%</b> per year (XIRR).`;
      } else if (realIRR === 0) {
        inflationMsg = `‚öñÔ∏è Your investment is projected to match inflation.`;
      } else {
        inflationMsg = `‚ö†Ô∏è Your investment may <b>not</b> keep up with inflation and could lose value in real terms.`;
      }

      document.getElementById('goal-result').innerHTML = `
  <strong>Future Corpus (Nominal):</strong> ‚Çπ${FV.toLocaleString('en-IN', {maximumFractionDigits:0})}<br>
  <strong>Future Corpus (Inflation-Adjusted):</strong> ‚Çπ${FVReal.toLocaleString('en-IN', {maximumFractionDigits:0})}<br>
  <strong>Total Invested:</strong> ‚Çπ${(P*months).toLocaleString('en-IN', {maximumFractionDigits:0})}<br>
  <strong>XIRR (Annualized Return):</strong> ${irr.toFixed(2)}%<br>
  <strong>Inflation-adjusted (Real) XIRR:</strong> ${realIRR.toFixed(2)}%<br>
  <strong>Selected Routes:</strong> ${routes.join(', ')}<br>
  <div style="margin-top:14px;font-size:1.11em;">${inflationMsg}</div>
      `;

      // Draw chart
      plotSIPCorpusChart({
        P: P,
        rate: rate,
        inflation: inflation,
        years: n,
        canvasId: "plotSIPCorpusChart"
      });

      // Show projection table and enable download
      showProjectionTable(P, rate, inflation, n);
	  document.getElementById('assumptions-section').style.display = "block";
      document.getElementById('chart-section').style.display = "block";
	  
	  // Show the Assumptions & Limitations section
      document.getElementById('assumptions-section').style.display = "block";

      // Example for GoalSet Calculator page
      localStorage.setItem("lastCalculator", JSON.stringify({
        name: "Investment Goal Calculator",
        date: new Date().toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' }),
        link: "investmentgoal.html"
      }));
    }
  </script>

  <script>
    function setMode(dark) {
      if (dark) {
        document.body.classList.add("dark-mode");
        localStorage.setItem("theme", "dark");
        document.getElementById('dm-label').textContent = "‚òÄÔ∏è Light Mode";
        document.getElementById('darkmode-toggle').checked = true;
      } else {
        document.body.classList.remove("dark-mode");
        localStorage.setItem("theme", "light");
        document.getElementById('dm-label').textContent = "üåô Dark Mode";
        document.getElementById('darkmode-toggle').checked = false;
      }
    }
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('darkmode-toggle').addEventListener("change", function() {
        setMode(this.checked);
      });
      const userPref = localStorage.getItem("theme");
      const darkPref = userPref === "dark" ||
        (!userPref && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
      setMode(darkPref);
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Remove all 'active' classes first
      document.querySelectorAll('nav a').forEach(function(link) {
        link.classList.remove('active');
        // Compare only the filename part to handle different hosting/path situations
        if (window.location.pathname.endsWith(link.getAttribute('href'))) {
          link.classList.add('active');
        }
      });
    });
  </script>


<button id="back-to-top" style="display:none;" aria-label="Back to Top">
  <svg width="28" height="28" viewBox="0 0 24 24" fill="none" style="vertical-align:middle;">
    <path d="M12 4L12 20" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M6 10L12 4L18 10" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <span style="margin-left:7px;vertical-align:middle;">Top</span>
</button>


<script>
window.addEventListener('scroll', function() {
  const btn = document.getElementById('back-to-top');
  if (!btn) return;
  // Show when user scrolls below 400px
  if (window.scrollY > 400) {
    btn.style.display = 'flex';
  } else {
    btn.style.display = 'none';
  }
});
document.getElementById('back-to-top').onclick = function() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
};

</script>


<script>
document.addEventListener('DOMContentLoaded', function() {
  // --- 1. Model Portfolio Definitions ---
  const modelPortfolios = {
  moderate: {
    label: "Moderate (Balanced)",
    allocation: { "Mutual Funds": 50, "Stocks": 30, "Bonds": 10, "Fixed Deposits": 10 },
    recommendations: {
      "Stocks": ["HDFC Bank", "Infosys", "Asian Paints"],
      "Mutual Funds": ["Axis Bluechip Fund", "HDFC Hybrid Equity"],
      "Bonds": ["REC Ltd NCD", "HDFC Ltd Bond"],
      "Fixed Deposits": ["SBI FD @ 6.7%", "HDFC Bank FD @ 7%"],
      "Cryptocurrencies": []
    }
  },
  aggressive: {
    label: "Aggressive (Growth)",
    allocation: { "Mutual Funds": 30, "Stocks": 50, "Bonds": 10, "Cryptocurrencies": 10 },
    recommendations: {
      "Stocks": ["Bharat Electronics", "Bharti Airtel", "Adani Enterprise"],
      "Mutual Funds": ["Quant Small Cap Fund", "Mirae Asset Emerging Bluechip"],
      "Bonds": ["Bharat Bond ETF"],
      "Fixed Deposits": [],
      "Cryptocurrencies": ["Bitcoin", "Ethereum", "Solana"]
    }
  },
  conservative: {
    label: "Conservative (Safe)",
    allocation: { "Mutual Funds": 25, "Bonds": 35, "Fixed Deposits": 35, "Stocks": 5 },
    recommendations: {
      "Stocks": ["ITC"],
      "Mutual Funds": ["ICICI Prudential Balanced Advantage"],
      "Bonds": ["PFC Bond", "ICICI NCD"],
      "Fixed Deposits": ["Post Office Time Deposit", "ICICI FD @ 7.25%"],
      "Cryptocurrencies": []
    }
  }
};


  let suggestApplied = false;

  // --- 2. Modal Show/Hide & Table Update ---
  window.showPortfolioModal = function() {
    document.getElementById('portfolio-modal').style.display = 'flex';
    document.getElementById('modal-total-amt').value = document.getElementById('total-amount-value').textContent.replace(/,/g, '') || 20000;
    updateSuggestionTable();
  }
  window.closePortfolioModal = function() {
    document.getElementById('portfolio-modal').style.display = 'none';
  }

  document.getElementById('risk-profile').addEventListener('change', updateSuggestionTable);
  document.getElementById('modal-total-amt').addEventListener('input', updateSuggestionTable);

  function updateSuggestionTable() {
  const risk = document.getElementById('risk-profile').value;
  const total = parseFloat(document.getElementById('modal-total-amt').value) || 0;
  const alloc = modelPortfolios[risk].allocation;
  const recs = modelPortfolios[risk].recommendations;

  let html = `<table style="width:100%;margin:7px 0 10px 0;">
    <tr><th>Route</th><th>Suggested %</th><th>Amount (‚Çπ)</th></tr>`;
  for (let route in alloc) {
    html += `<tr>
      <td>${route}</td>
      <td>${alloc[route]}%</td>
      <td>‚Çπ${Math.round((total * alloc[route]) / 100).toLocaleString('en-IN')}</td>
    </tr>`;
  }
  html += "</table>";

  html += `<div style="margin-top:10px;"><h4 style="color:#004080;">üîç Top Investment Picks</h4><ul style="padding-left:20px;">`;
  for (let route in recs) {
    if (recs[route] && recs[route].length > 0) {
      html += `<li><b>${route}:</b> ${recs[route].join(', ')}</li>`;
    }
  }
  html += "</ul></div>";

  document.getElementById('suggestion-table').innerHTML = html;
}


  // --- 3. Apply Portfolio: Autofill & Flag ---
  window.applySuggestedPortfolio = function() {
    const risk = document.getElementById('risk-profile').value;
    const total = parseFloat(document.getElementById('modal-total-amt').value) || 0;
    const alloc = modelPortfolios[risk].allocation;
    const select = document.getElementById('routes');
    // Select relevant options
    for (let i = 0; i < select.options.length; i++) {
      select.options[i].selected = alloc.hasOwnProperty(select.options[i].value);
    }
    // Generate fields and fill values
    generateAmountFields();
    for (let route in alloc) {
      const inputId = `amount-${route.replace(/\s+/g, '').toLowerCase()}`;
      const field = document.getElementById(inputId);
      if (field) field.value = Math.round((total * alloc[route]) / 100);
    }
    updateTotalAmount();
    closePortfolioModal();
    suggestApplied = true;
  }

    // --- 6. Detect Manual User Change & Disable ---
  document.getElementById('route-amount-fields').addEventListener('input', function() {
    if (suggestApplied) disableSuggestPortfolio();
  });
  document.getElementById('routes').addEventListener('change', function() {
    if (suggestApplied) disableSuggestPortfolio();
  });

});

// Tooltip logic for the info icon
document.addEventListener('DOMContentLoaded', function() {
  const info = document.getElementById('return-info');
  const tip = document.getElementById('rate-tooltip');
  const routesSelect = document.getElementById('routes');
  
  function updateRateTooltip() {
    const selected = Array.from(routesSelect.selectedOptions).map(opt => opt.value);
    let html = `<strong>Historic Average Returns:</strong><br><span style="display:block;margin-top:5px;">`;
    let shown = 0;
    selected.forEach(route => {
      if (historicReturns[route]) {
        html += `<b>${route}:</b> ${historicReturns[route]}<br>`;
        shown++;
      }
    });
    if (!shown) {
      html += `<span style="color:#be3636;">Select a route to see reference returns.</span>`;
    }
    html += `</span><span style="display:block;margin-top:7px;font-size:0.95em;color:#a17512;">Tip: Use these as a starting point. Check latest rates for accuracy.</span>`;
    tip.innerHTML = html;
  }

  // --- Always update tooltip *before* showing it
  function showTooltip() {
    updateRateTooltip();
    tip.style.display = 'block';
  }
  function hideTooltip() {
    tip.style.display = 'none';
  }

  if (info && tip) {
    info.addEventListener('mouseenter', showTooltip);
    info.addEventListener('focus', showTooltip);
    info.addEventListener('mouseleave', hideTooltip);
    info.addEventListener('blur', hideTooltip);

    info.addEventListener('click', function(e) {
      // Toggle tooltip
      if (tip.style.display === 'block') {
        hideTooltip();
      } else {
        showTooltip();
      }
      e.stopPropagation();
    });
    document.body.addEventListener('click', hideTooltip);
  }

  // Update tooltip when routes selection changes (with slight delay to ensure selectedOptions is updated)
  routesSelect.addEventListener('change', function() {
    setTimeout(updateRateTooltip, 10);
  });

  // Show the correct info on first page load too
  updateRateTooltip();
});

//Inflation Tooltip

document.addEventListener('DOMContentLoaded', function() {
  const inflInfo = document.getElementById('inflation-info');
  const inflTip = document.getElementById('inflation-tooltip');

  function inflationTooltipHtml() {
    let avg = (indiaInflationHistory.reduce((sum, row) => sum + row.rate, 0) / indiaInflationHistory.length).toFixed(1);
    let html = `<strong>India's CPI Inflation (YoY, %):</strong><br>
      <table style="font-size:0.98em;margin-top:5px;">
        <tr><th style="text-align:left;">Year</th><th style="text-align:right;">Inflation</th></tr>
        ${indiaInflationHistory.map(row =>
          `<tr><td style="text-align:left;">${row.year}</td><td style="text-align:right;">${row.rate}%</td></tr>`
        ).join('')}
      </table>
      <div style="margin-top:8px;font-size:0.97em;">
        <b>15-yr Average:</b> <span style="color:#004080;">${avg}%</span>
        <br><span style="color:#a17512;">Tip: You may use an average of 5.5-6% for long-term planning.</span>
      </div>
      <div style="font-size:0.93em;margin-top:5px;color:#888;">Source: RBI, MOSPI, World Bank, TradingEconomics</div>
    `;
    return html;
  }

  if (inflInfo && inflTip) {
    inflInfo.addEventListener('mouseenter', function() {
      inflTip.innerHTML = inflationTooltipHtml();
      inflTip.style.display = 'block';
    });
    inflInfo.addEventListener('focus', function() {
      inflTip.innerHTML = inflationTooltipHtml();
      inflTip.style.display = 'block';
    });
    inflInfo.addEventListener('mouseleave', function() { inflTip.style.display = 'none'; });
    inflInfo.addEventListener('blur', function() { inflTip.style.display = 'none'; });
    inflInfo.addEventListener('click', function(e) {
      if (inflTip.style.display === 'block') {
        inflTip.style.display = 'none';
      } else {
        inflTip.innerHTML = inflationTooltipHtml();
        inflTip.style.display = 'block';
      }
      e.stopPropagation();
    });
    document.body.addEventListener('click', function() { inflTip.style.display = 'none'; });
  }
});


</script>


<script>
// Place this outside any DOMContentLoaded or function

window.suggestApplied = false;

function disableSuggestPortfolio() {
  const btn = document.getElementById('suggest-portfolio-btn');
  const msg = document.getElementById('suggest-portfolio-msg');
  if (btn) {
    btn.disabled = true;
    btn.style.opacity = 0.55;
  }
  if (msg) {
    msg.style.display = 'block';
  }
}

function enableSuggestPortfolio() {
  const btn = document.getElementById('suggest-portfolio-btn');
  const msg = document.getElementById('suggest-portfolio-msg');
  if (btn) {
    btn.disabled = false;
    btn.style.opacity = 1;
  }
  if (msg) {
    msg.style.display = 'none';
  }
  window.suggestApplied = false;
}
</script>



</body>
</html>

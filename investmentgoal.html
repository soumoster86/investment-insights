<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Investment Insights - Investment Goal</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      background: linear-gradient(120deg, #e9f0fd 0%, #f4f6f8 100%);
      color: #222;
      min-height: 100vh;
      transition: background 0.4s, color 0.3s;
    }
    header {
      background: #004080;
      color: white;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    header img {
      height: 50px;
      margin-right: 15px;
      border-radius: 10px;
      background: #fff;
      padding: 3px;
      box-shadow: 0 2px 6px #0001;
    }
    header h1 {
      margin: 0;
      font-weight: normal;
      font-size: 1.5em;
    }
    #dm-label {
      color: white;
      font-size: 1em;
    }
    nav {
      width: 100%;
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      background: none;
      color: inherit;
    }
    nav a {
      color: white;
      text-decoration: none;
      margin: 0 14px;
      font-weight: 500;
      font-size: 1.08em;
      padding: 7px 10px;
      border-radius: 7px;
      transition: background .22s;
    }
    nav a.active,
    nav a:hover {
      background: #012b54;
      text-decoration: underline;
    }
    main {
      max-width: 900px;
      margin: 36px auto 24px auto;
      padding: 0 15px 30px 15px;
      background: #fff;
      box-shadow: 0 2px 12px rgb(0 64 128 / 8%);
      border-radius: 18px;
      min-height: 75vh;
      animation: fadeIn 0.8s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px);}
      to   { opacity: 1; transform: translateY(0);}
    }
    section {
      margin-bottom: 34px;
      padding: 20px 22px;
      border: 1.5px solid #e1e6f2;
      border-radius: 12px;
      background: #f9faff;
      box-shadow: 0 1px 10px #00408009;
      transition: box-shadow 0.18s, border-color 0.2s;
    }
    section:hover {
      box-shadow: 0 2px 22px #00408017;
      border-color: #00408055;
    }
    h2 {
      border-bottom: 2px solid #004080;
      padding-bottom: 8px;
      color: #004080;
      margin-top: 0;
      font-size: 1.5em;
    }
    h3 {
      color: #004080;
      font-size: 1.17em;
      margin-bottom: 12px;
      margin-top: 20px;
    }
    .stock-card {
      background: #f8faff;
      border-radius: 10px;
      box-shadow: 0 1px 8px #a4b1cf18;
      border: 1.3px solid #e4eaf2;
      padding: 15px 13px 14px 13px;
      min-width: 230px;
      max-width: 245px;
      flex: 1 0 200px;
      transition: box-shadow 0.15s, border-color 0.16s;
    }
    .stock-card:hover {
      box-shadow: 0 2px 14px #3070c41e;
      border-color: #96b6f6;
    }
    .sector-chip {
      background: #eaf2ff;
      color: #2766be;
      border-radius: 5px;
      padding: 1px 7px;
      font-size: 0.85em;
      margin-left: 7px;
    }
    .floating-toc {
      position: fixed;
      top: 140px;
      right: 30px;
      width: 200px;
      background: #fff;
      border: 1.4px solid #e1e6f2;
      box-shadow: 0 2px 16px #00408016;
      border-radius: 12px;
      padding: 12px 16px 10px 16px;
      z-index: 1001;
      font-size: 1em;
      opacity: 0.98;
      transition: box-shadow 0.22s, background 0.22s, color 0.22s;
    }
    .floating-toc .toc-title {
      font-weight: 600;
      color: #004080;
      margin-bottom: 7px;
      font-size: 1.06em;
      letter-spacing: 0.2px;
    }
    .floating-toc ul {
      margin: 0;
      padding: 0;
      list-style: none;
    }
    .floating-toc ul li {
      margin: 6px 0;
    }
    .floating-toc a {
      color: #204a80;
      text-decoration: none;
      font-size: 0.98em;
      transition: color 0.16s;
    }
    .floating-toc a:hover,
    .floating-toc a.active {
      color: #1c6ddb;
      text-decoration: underline;
    }
    footer {
      text-align: center;
      padding: 18px 0 13px 0;
      font-size: 0.97em;
      color: #666;
      border-top: 1px solid #e0e5f0;
      margin-top: 24px;
      background: #fafbfc;
      position: relative;
      left: 0;
      right: 0;
    }
    /* Dark mode overrides */
    body.dark-mode {
      background: linear-gradient(120deg,#141b27 0%, #22242a 100%) !important;
      color: #e7ecfa !important;
    }
    body.dark-mode header, body.dark-mode nav, body.dark-mode footer {
      background: #12203a !important;
      color: #e7ecfa !important;
    }
    body.dark-mode main, body.dark-mode section, body.dark-mode .stock-card {
      background: #191c23 !important;
      color: #e7ecfa !important;
      box-shadow: 0 2px 12px #0004;
      border-color: #2d3752 !important;
    }
    body.dark-mode h2, body.dark-mode h3, body.dark-mode .floating-toc .toc-title {
      color: #8abaff !important;
      border-color: #273a5a !important;
    }
    body.dark-mode .floating-toc {
      background: #1a2030 !important;
      border-color: #273a5a !important;
      color: #8abaff !important;
      box-shadow: 0 2px 16px #0018;
    }
    body.dark-mode .floating-toc a {
      color: #8abaff !important;
    }
    body.dark-mode .floating-toc a:hover,
    body.dark-mode .floating-toc a.active {
      color: #48a7ff !important;
    }
    body.dark-mode nav a {
      color: #8abaff !important;
    }
    body.dark-mode nav a.active,
    body.dark-mode nav a:hover {
      background: #274272 !important;
      color: #fff !important;
    }
    body.dark-mode .stock-card {
      background: #23273b !important;
      color: #e7ecfa !important;
      border-color: #39588a !important;
    }
    body.dark-mode .sector-chip {
      background: #2d3752 !important;
      color: #8abaff !important;
    }
    body.dark-mode #dm-label { color: #fff !important; }
    /* Responsive for ToC */
    @media (max-width: 900px) {
      .floating-toc {
        right: 8px;
        width: 88vw;
        min-width: 155px;
        max-width: 97vw;
        font-size: 0.97em;
        top: unset;
        bottom: 16px;
        padding: 10px 13px 10px 13px;
        border-radius: 10px;
        opacity: 0.97;
      }
    }
    @media (max-width: 600px) {
      .floating-toc {
        right: 2vw;
        left: 2vw;
        width: unset;
        font-size: 1em;
        padding: 10px 6vw;
        top: unset;
        bottom: 14px;
        border-radius: 10px;
        max-width: unset;
        min-width: unset;
      }
    }
  </style>
</head>
<body>
  <header style="display: flex; align-items: center; justify-content: space-between; padding: 15px 20px; background-color: #004080; color: white; flex-wrap: wrap;">
    <div style="display: flex; align-items: center;">
      <img src="logo.png" alt="Investment Insights Logo" style="height: 50px; margin-right: 15px;" />
      <h1 style="margin: 0; font-weight: normal; font-size: 1.5em;">Investment Insights</h1>
    </div>
    <label style="display: flex; align-items: center; gap: 8px; cursor:pointer; margin-top: 10px;">
      <input type="checkbox" id="darkmode-toggle" style="width:20px; height:20px;" />
      <span id="dm-label" style="color:white;font-size:1em;">üåô Dark Mode</span>
    </label>
    <nav style="width: 100%; margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px;">
      <a href="index.html" class="active">üè† Home</a>
      <a href="stocks.html">üìä Stocks</a>
      <a href="mutualfunds.html">üìÅ Mutual Funds</a>
      <a href="fixeddeposit.html">üè¶ Fixed Deposits</a>
      <a href="cryptocurrencies.html">üí± Cryptocurrencies</a>
      <a href="bonds.html">üí∏ Bonds</a>
      <a href="investmentgoal.html">üéØ Investment Goal</a>
      <a href="contact.html">‚úâÔ∏è Contact</a>
    </nav>
  </header>
  <main>
    <section>
      <h2>Set Your Investment Goal</h2>
      <form id="goal-form" onsubmit="calculateGoal(event)">
        <label for="routes">Select Investment Routes:</label>
		<select id="routes" multiple required style="height: 110px;" onchange="generateAmountFields()">
			<option value="Stocks">Stocks</option>
			<option value="Mutual Funds">Mutual Funds</option>
			<option value="Bonds">Bonds</option>
			<option value="Fixed Deposits">Fixed Deposits</option>
			<option value="Cryptocurrencies">Cryptocurrencies</option>
		</select>
	<small style="color:#555;display:block;margin-bottom:12px;">(Hold Ctrl/Cmd to select multiple options)</small>

<!-- Dynamic input fields for amounts -->
<div id="route-amount-fields" style="margin-bottom: 10px;"></div>

<!-- Show total monthly investment -->
<div id="total-monthly-amount" style="font-weight: bold; color: #004080; margin-bottom: 14px;">
  Total Monthly Investment: ‚Çπ<span id="total-amount-value">0</span>
</div>


        <label for="rate">Expected Rate of Return (% per year):</label>
        <input type="number" id="rate" step="0.01" min="0" required placeholder="e.g. 11">

        <label for="inflation">Expected Inflation Rate (% per year):</label>
        <input type="number" id="inflation" step="0.01" min="0" required placeholder="e.g. 6">

        <label for="duration">Investment Duration (years):</label>
        <input type="number" id="duration" min="1" required placeholder="e.g. 15">

        <div style="display: flex; gap: 14px;">
        <button type="submit" class="btn">Calculate Future Corpus</button>
        <button type="button" class="btn secondary" onclick="resetGoalForm()">Reset</button>
        </div>

      </form>
      <div id="goal-result" style="margin-top:18px;font-size:1.13em;color:#004080;font-weight:500;"></div>

      <!-- Chart Container -->
      <div style="margin:24px 0 0 0; background:#fff; border-radius:12px; padding:12px 6px;">
        <canvas id="plotSIPCorpusChart" style="max-width:100%;"></canvas>
      </div>
    </section>
  </main>
  <footer>
    &copy; 2025 Investment Insights. All rights reserved.
  </footer>


  <script>
  
  
    //Reset Button functionality
	
	function resetGoalForm() {
  // Reset the form fields
  document.getElementById('goal-form').reset();

  // Clear dynamic amount fields and total
  document.getElementById('route-amount-fields').innerHTML = '';
  document.getElementById('total-amount-value').textContent = '0';

  // Clear results and chart
  document.getElementById('goal-result').innerHTML = '';
  if (window.corpusChartInstance) window.corpusChartInstance.destroy();
}
	
    //Generate Total Amount Dynamically
	
	function generateAmountFields() {
  const selected = Array.from(document.getElementById('routes').selectedOptions).map(opt => opt.value);
  const container = document.getElementById('route-amount-fields');
  container.innerHTML = ''; // clear previous

  selected.forEach(route => {
    // Use route as the id for its input
    const inputId = `amount-${route.replace(/\s+/g, '').toLowerCase()}`;
    container.innerHTML += `
      <label for="${inputId}">Monthly Investment in ${route} (‚Çπ):</label>
      <input type="number" min="0" id="${inputId}" class="route-amount" placeholder="Amount for ${route}" oninput="updateTotalAmount()" required>
    `;
  });

  updateTotalAmount(); // reset total when selection changes
}

// Calculate and update total monthly investment
function updateTotalAmount() {
  const inputs = document.querySelectorAll('.route-amount');
  let total = 0;
  inputs.forEach(input => {
    const val = parseFloat(input.value);
    if (!isNaN(val) && val > 0) total += val;
  });
  document.getElementById('total-amount-value').textContent = total.toLocaleString('en-IN');
}
    
    
    // XIRR Helper Function
    function xirr(cashFlows, dates, guess = 0.1) {
      const tol = 1e-7, maxIter = 100;
      const dayMs = 1000 * 60 * 60 * 24;
      const xnpv = (rate) => cashFlows.reduce((sum, c, i) =>
        sum + c / Math.pow(1 + rate, (dates[i] - dates[0]) / dayMs / 365), 0);

      let rate = guess;
      for (let iter = 0; iter < maxIter; iter++) {
        const npv = xnpv(rate);
        const dRate = rate * 1.0001 || 1e-6;
        const dNpv = (xnpv(dRate) - npv) / (dRate - rate);
        const newRate = rate - npv / dNpv;
        if (Math.abs(newRate - rate) < tol) return newRate;
        rate = newRate;
      }
      return rate;
    }

    // Chart Drawing Function
    function plotSIPCorpusChart({ P, rate, inflation, years, canvasId = "plotSIPCorpusChart" }) {
  const yearlyCorpus = [];
  const yearlyCorpusReal = [];
  const labels = [];
  const r = rate / 100 / 12;
  for (let year = 1; year <= years; year++) {
    const months = year * 12;
    const FV = r === 0
      ? P * months
      : P * (((Math.pow(1 + r, months) - 1) / r) * (1 + r));
    const inflationFactor = Math.pow(1 + inflation / 100, year);
    yearlyCorpus.push(FV);
    yearlyCorpusReal.push(FV / inflationFactor);
    labels.push('Year ' + year);
  }
  const ctx = document.getElementById(canvasId).getContext('2d');
  if (window.corpusChartInstance) window.corpusChartInstance.destroy();
  window.corpusChartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [
        {
          label: 'Corpus (Nominal ‚Çπ)',
          data: yearlyCorpus,
          borderWidth: 2.5,
          borderColor: '#004080',
          backgroundColor: 'rgba(0,64,128,0.08)',
          tension: 0.15,
          pointRadius: 2,
          fill: false,
        },
        {
          label: 'Corpus (Inflation-Adjusted ‚Çπ)',
          data: yearlyCorpusReal,
          borderWidth: 2.2,
          borderColor: '#6c93db',
          backgroundColor: 'rgba(108,147,219,0.09)',
          tension: 0.18,
          pointRadius: 2,
          fill: false,
          borderDash: [6, 4],
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: true, position: 'bottom' },
        tooltip: {
          // Show both values for a year, even if you hover only on one line
          callbacks: {
            title: function(ctx) {
              // "Year X"
              return ctx[0].label;
            },
            label: function(ctx) {
              // ctx.datasetIndex: 0 for nominal, 1 for real
              // Show "Corpus (Nominal ‚Çπ): ‚Çπxx,xx,xxx"
              const value = ctx.parsed.y;
              const label = ctx.dataset.label;
              return label + ': ‚Çπ' + Math.round(value).toLocaleString();
            },
            afterBody: function(ctx) {
              // Only display if there are two datasets (for safety)
              if (ctx.length === 1 && ctx[0].datasetIndex === 0 && ctx[0].chart.data.datasets.length > 1) {
                // Find the real value for this year
                const yearIndex = ctx[0].dataIndex;
                const realValue = ctx[0].chart.data.datasets[1].data[yearIndex];
                return 'Corpus (Inflation-Adjusted ‚Çπ): ‚Çπ' + Math.round(realValue).toLocaleString();
              } else if (ctx.length === 1 && ctx[0].datasetIndex === 1 && ctx[0].chart.data.datasets.length > 0) {
                // Find the nominal value for this year
                const yearIndex = ctx[0].dataIndex;
                const nominalValue = ctx[0].chart.data.datasets[0].data[yearIndex];
                return 'Corpus (Nominal ‚Çπ): ‚Çπ' + Math.round(nominalValue).toLocaleString();
              }
              // If already showing both lines, do nothing (default will show both)
              return '';
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: function(val) {
              return '‚Çπ' + (val / 100000 >= 1 ? (val / 100000).toFixed(1) + 'L' : val.toLocaleString());
            }
          }
        }
      }
    }
  });
}


    // Main Calculation Function
    function calculateGoal(event) {
      event.preventDefault();
      let P = 0;
      document.querySelectorAll('.route-amount').forEach(input => {
      const val = parseFloat(input.value);
      if (!isNaN(val) && val > 0) P += val;
     });
      const rate = parseFloat(document.getElementById('rate').value);
      const inflation = parseFloat(document.getElementById('inflation').value);
      const n = parseInt(document.getElementById('duration').value);
      const routes = Array.from(document.getElementById('routes').selectedOptions).map(opt => opt.value);
      
	  if (P <= 0) {
      alert('Please enter at least one investment amount.');
      return;
      }
	  
      if (isNaN(P) || P <= 0 || isNaN(rate) || rate < 0 || isNaN(inflation) || inflation < 0 || isNaN(n) || n <= 0 || routes.length === 0) {
        alert('Please fill all fields correctly.');
        return;
      }

      const r = rate / 100 / 12;
      const months = n * 12;
      let FV;
      if (r === 0) {
        FV = P * months;
      } else {
        FV = P * (((Math.pow(1 + r, months) - 1) / r) * (1 + r));
      }
	  
	  // Inflation-adjusted corpus
      const inflationFactor = Math.pow(1 + inflation / 100, n);
      const FVReal = FV / inflationFactor;


      // XIRR Calculation
      const cashFlows = [];
      const dates = [];
      const startDate = new Date();
      for (let i = 0; i < months; i++) {
        const d = new Date(startDate.getFullYear(), startDate.getMonth() + i, startDate.getDate());
        cashFlows.push(-P);
        dates.push(d);
      }
      const endDate = new Date(startDate.getFullYear(), startDate.getMonth() + months, startDate.getDate());
      cashFlows.push(FV);
      dates.push(endDate);

      const irr = xirr(cashFlows, dates) * 100;
      const realIRR = irr - inflation;

      let inflationMsg;
      if (realIRR > 0) {
        inflationMsg = `üéâ Your investment is projected to beat inflation by <b>${realIRR.toFixed(2)}%</b> per year (XIRR).`;
      } else if (realIRR === 0) {
        inflationMsg = `‚öñÔ∏è Your investment is projected to match inflation.`;
      } else {
        inflationMsg = `‚ö†Ô∏è Your investment may <b>not</b> keep up with inflation and could lose value in real terms.`;
      }

      document.getElementById('goal-result').innerHTML = `
  <strong>Future Corpus (Nominal):</strong> ‚Çπ${FV.toLocaleString(undefined, {maximumFractionDigits:0})}<br>
  <strong>Future Corpus (Inflation-Adjusted):</strong> ‚Çπ${FVReal.toLocaleString(undefined, {maximumFractionDigits:0})}<br>
  <strong>Total Invested:</strong> ‚Çπ${(P*months).toLocaleString(undefined, {maximumFractionDigits:0})}<br>
  <strong>XIRR (Annualized Return):</strong> ${irr.toFixed(2)}%<br>
  <strong>Inflation-adjusted (Real) XIRR:</strong> ${realIRR.toFixed(2)}%<br>
  <strong>Selected Routes:</strong> ${routes.join(', ')}<br>
  <div style="margin-top:14px;font-size:1.11em;">${inflationMsg}</div>
      `;

      // Draw chart
      plotSIPCorpusChart({
        P: P,
        rate: rate,
        inflation: inflation,
        years: n,
        canvasId: "plotSIPCorpusChart"
      });
    }
  </script>

  <script>
    function setMode(dark) {
      if (dark) {
        document.body.classList.add("dark-mode");
        localStorage.setItem("theme", "dark");
        document.getElementById('dm-label').textContent = "‚òÄÔ∏è Light Mode";
        document.getElementById('darkmode-toggle').checked = true;
      } else {
        document.body.classList.remove("dark-mode");
        localStorage.setItem("theme", "light");
        document.getElementById('dm-label').textContent = "üåô Dark Mode";
        document.getElementById('darkmode-toggle').checked = false;
      }
    }
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('darkmode-toggle').addEventListener("change", function() {
        setMode(this.checked);
      });
      const userPref = localStorage.getItem("theme");
      const darkPref = userPref === "dark" ||
        (!userPref && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
      setMode(darkPref);
    });
  </script>
</body>
</html>
